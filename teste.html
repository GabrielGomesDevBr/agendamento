<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste CliniAgende v4</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-2xl mx-auto bg-white p-6 rounded-lg shadow-lg">
        <h1 class="text-3xl font-bold mb-6">CliniAgende v4 - Teste de Funcionalidades</h1>
        
        <div class="space-y-4">
            <button onclick="testLogin()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded">
                Teste Login Terapeuta
            </button>
            
            <button onclick="testModal()" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded">
                Teste Modal
            </button>
            
            <button onclick="testToast()" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded">
                Teste Toast
            </button>
            
            <button onclick="testData()" class="w-full bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded">
                Teste Dados
            </button>
            
            <div id="test-results" class="mt-6 p-4 bg-gray-50 rounded"></div>
        </div>
    </div>

    <!-- Modal container -->
    <div id="modals-container"></div>
    
    <!-- Toast container -->
    <div id="toast-container" class="fixed top-5 right-5 z-50 space-y-2"></div>

    <!-- Scripts -->
    <script src="js/utils.js"></script>
    <script src="js/data.js"></script>
    <script src="js/calendar.js"></script>
    <script src="js/forms.js"></script>
    <script src="js/app.js"></script>

    <script>
        async function testLogin() {
            try {
                if (!App.initialized) {
                    await App.init();
                }
                App.loginAs('terapeuta');
                
                // Check if user is logged in
                if (App.currentUser && App.currentUser.role === 'terapeuta') {
                    updateResults('âœ… Login funcionando! UsuÃ¡rio: ' + App.currentUser.data.name);
                } else {
                    updateResults('âŒ Login falhou - usuÃ¡rio nÃ£o definido');
                }
            } catch (error) {
                updateResults('âŒ Erro no login: ' + error.message);
                console.error('Login error:', error);
            }
        }

        function testModal() {
            try {
                const functions = [
                    'openAvailabilityModal',
                    'openBookingModal', 
                    'openPatientProfileModal',
                    'openStatusUpdateModal'
                ];
                
                functions.forEach(funcName => {
                    if (typeof window[funcName] === 'function') {
                        updateResults(`âœ… FunÃ§Ã£o ${funcName} existe`);
                    } else {
                        updateResults(`âŒ FunÃ§Ã£o ${funcName} nÃ£o encontrada`);
                    }
                });
            } catch (error) {
                updateResults('âŒ Erro no modal: ' + error.message);
            }
        }

        function testToast() {
            try {
                Utils.showToast('Teste de notificaÃ§Ã£o', 'success');
                updateResults('âœ… Toast funcionando!');
            } catch (error) {
                updateResults('âŒ Erro no toast: ' + error.message);
            }
        }

        function testData() {
            try {
                const terapeutas = dataManager.getTerapeutas();
                const pacientes = dataManager.getPacientes();
                const agendamentos = dataManager.getAgendamentos();
                
                updateResults(`âœ… Terapeutas carregados: ${terapeutas.length}`);
                updateResults(`âœ… Pacientes carregados: ${pacientes.length}`);
                updateResults(`âœ… Agendamentos gerados: ${agendamentos.length}`);
                
                if (terapeutas.length > 0) {
                    updateResults(`ğŸ“‹ Primeiro terapeuta: ${terapeutas[0].name}`);
                }
                if (pacientes.length > 0) {
                    updateResults(`ğŸ“‹ Primeiro paciente: ${pacientes[0].nome}`);
                }
            } catch (error) {
                updateResults('âŒ Erro nos dados: ' + error.message);
            }
        }

        function updateResults(message) {
            const results = document.getElementById('test-results');
            const div = document.createElement('div');
            div.innerHTML = message;
            div.className = 'py-1 border-b border-gray-200 text-sm';
            results.appendChild(div);
        }

        // Test initialization
        document.addEventListener('DOMContentLoaded', async () => {
            lucide.createIcons();
            updateResults('ğŸ“„ PÃ¡gina carregada');
            
            try {
                await App.init();
                updateResults('âœ… App inicializado com sucesso');
            } catch (error) {
                updateResults('âŒ Erro na inicializaÃ§Ã£o: ' + error.message);
            }
        });
    </script>
</body>
</html>